<!-- header.html — Mōchirīī (Where Winds Meet) Global Header -->
<header id="site-header" class="site-header" data-state="top">
  <div class="header-wrap">
    <!-- Brand -->
    <a class="brand" href="./index.html" aria-label="Mōchirīī Home">
      <span class="brand-mark" aria-hidden="true">
      <svg viewBox="0 0 128 128" class="lotus-svg" xmlns="http://www.w3.org/2000/svg">
        <path d="M64 16c8 18 8 30 0 48-8-18-8-30 0-48Z" />
        <path d="M32 32c16 10 24 20 32 40-18-6-28-16-32-40Z" />
        <path d="M96 32c-4 24-14 34-32 40 8-20 16-30 32-40Z" />
        <path d="M24 64c20 6 34 14 40 32-24-4-34-14-40-32Z" />
        <path d="M104 64c-6 18-16 28-40 32 6-18 20-26 40-32Z" />
      </svg>
    </span>
      <span class="brand-text">
        <span class="brand-name">Mōchirīī</span>
        <span class="brand-sub">Where Winds Meet Guild</span>
      </span>
    </a>

    <!-- Desktop Nav -->
    <nav class="nav" aria-label="Primary">
      <a class="nav-link" href="./index.html" data-nav="home">Home</a>
      <a class="nav-link" href="./announcements.html" data-nav="announcements">Announcements</a>
      <a class="nav-link" href="./raffles.html" data-nav="raffles">Raffles</a>
      <a class="nav-link" href="./events.html" data-nav="events">Events</a>
      <a class="nav-link" href="./ranks.html" data-nav="ranks">Ranks</a>
      <a class="nav-link" href="./leaders.html" data-nav="leaders">Leaders</a>
      <a class="nav-link" href="./codex.html" data-nav="codex">Codex</a>
      <a class="nav-link" href="./recruitment.html" data-nav="recruitment">Recruitment</a>
    </nav>

    <!-- Utilities -->
    <div class="utils">
      <button class="icon-btn" type="button" id="cmdk-btn" aria-label="Quick links" aria-haspopup="dialog">
        <!-- Search / command icon -->
        <svg viewBox="0 0 24 24" aria-hidden="true" class="icon">
          <path
            d="M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Zm6.11-1.39 4.14 4.14"
            fill="none"
            stroke="currentColor"
            stroke-width="1.8"
            stroke-linecap="round"
          />
        </svg>
        <span class="kbd-hint" aria-hidden="true">/</span>
      </button>

      <a class="cta" href="./join.html" aria-label="Join Mōchirīī">
        Join
        <span class="cta-glint" aria-hidden="true"></span>
      </a>

      <button class="burger" type="button" id="menu-btn" aria-label="Open menu" aria-expanded="false" aria-controls="mobile-menu">
        <span class="burger-lines" aria-hidden="true"></span>
      </button>
    </div>
  </div>

  <!-- Mobile Menu Sheet -->
  <div class="mobile-shell" id="mobile-menu" role="dialog" aria-modal="true" aria-label="Menu" hidden>
    <div class="mobile-scrim" data-close></div>
    <div class="mobile-sheet" role="document">
      <div class="mobile-top">
        <a class="brand brand--mobile" href="./index.html" aria-label="Mōchirīī Home">
          <span class="brand-mark" aria-hidden="true">
          <svg viewBox="0 0 128 128" class="lotus-svg" xmlns="http://www.w3.org/2000/svg">
            <path d="M64 16c8 18 8 30 0 48-8-18-8-30 0-48Z" />
            <path d="M32 32c16 10 24 20 32 40-18-6-28-16-32-40Z" />
            <path d="M96 32c-4 24-14 34-32 40 8-20 16-30 32-40Z" />
            <path d="M24 64c20 6 34 14 40 32-24-4-34-14-40-32Z" />
            <path d="M104 64c-6 18-16 28-40 32 6-18 20-26 40-32Z" />
          </svg>
        </span>
          <span class="brand-text">
            <span class="brand-name">Mōchirīī</span>
            <span class="brand-sub">Where Winds Meet Guild</span>
          </span>
        </a>
        <button class="icon-btn" type="button" data-close aria-label="Close menu">
          <svg viewBox="0 0 24 24" aria-hidden="true" class="icon">
            <path
              d="M6 6 18 18M18 6 6 18"
              fill="none"
              stroke="currentColor"
              stroke-width="1.8"
              stroke-linecap="round"
            />
          </svg>
        </button>
      </div>

      <nav class="mobile-nav" aria-label="Primary mobile">
        <a class="mobile-link" href="./index.html">Home</a>
        <a class="mobile-link" href="./announcements.html">Announcements</a>
        <a class="mobile-link" href="./raffles.html">Raffles</a>
        <a class="mobile-link" href="./events.html">Events</a>
        <a class="mobile-link" href="./ranks.html">Ranks</a>
        <a class="mobile-link" href="./leaders.html">Leaders</a>
        <a class="mobile-link" href="./codex.html">Codex</a>
        <a class="mobile-link" href="./recruitment.html">Recruitment</a>
        <a class="mobile-link" href="./gallery.html">Gallery</a>
      </nav>

      <div class="mobile-footer">
        <a class="cta cta--full" href="./join.html">Join Mōchirīī<span class="cta-glint" aria-hidden="true"></span></a>
        <p class="mobile-note">Tip: press “/” for quick links.</p>
      </div>
    </div>
  </div>

  <!-- Command Palette (Static-site friendly) -->
  <div class="cmdk" id="cmdk" role="dialog" aria-modal="true" aria-label="Quick links" hidden>
    <div class="cmdk-scrim" data-cmdk-close></div>
    <div class="cmdk-panel" role="document">
      <div class="cmdk-head">
        <div class="cmdk-title">Quick Links</div>
        <div class="cmdk-hints" aria-hidden="true">
          <span class="pill">Enter</span> open
          <span class="pill">Esc</span> close
        </div>
      </div>

      <label class="sr-only" for="cmdk-input">Search links</label>
      <input id="cmdk-input" class="cmdk-input" type="text" inputmode="search" autocomplete="off" placeholder="Type to filter…"/>

      <div class="cmdk-list" id="cmdk-list" role="listbox" aria-label="Links">
        <button class="cmdk-item" type="button" data-href="./announcements.html"><span>Announcements</span><span class="meta">Updates</span></button>
        <button class="cmdk-item" type="button" data-href="./events.html"><span>Events</span><span class="meta">Schedule</span></button>
        <button class="cmdk-item" type="button" data-href="./raffles.html"><span>Raffles</span><span class="meta">Prizes</span></button>
        <button class="cmdk-item" type="button" data-href="./ranks.html"><span>Ranks</span><span class="meta">Path</span></button>
        <button class="cmdk-item" type="button" data-href="./leaders.html"><span>Leaders</span><span class="meta">Council</span></button>
        <button class="cmdk-item" type="button" data-href="./codex.html"><span>Codex</span><span class="meta">Lore</span></button>
        <button class="cmdk-item" type="button" data-href="./join.html"><span>Join</span><span class="meta">Apply</span></button>
        <button class="cmdk-item" type="button" data-href="./recruitment.html"><span>Recruitment</span><span class="meta">Guide</span></button>
        <button class="cmdk-item" type="button" data-href="./gallery.html"><span>Gallery</span><span class="meta">Showcase</span></button>
      </div>
    </div>
  </div>
</header>

<style>
  /* Song Dynasty-inspired palette: ink, parchment, lantern gold, jade, cinnabar.
     These are design tokens. Tune them once; everything updates. */
  :root{
    --ink-0: rgba(255,255,255,0.92);
    --ink-1: rgba(255,255,255,0.78);
    --ink-2: rgba(255,255,255,0.60);

    --bg-0: rgba(10, 12, 14, 0.82);   /* night ink */
    --bg-1: rgba(10, 12, 14, 0.58);
    --line: rgba(255,255,255,0.08);

    --jade: #1f7a63;        /* deep jade */
    --lantern: #c8a24b;     /* warm gold */
    --cinnabar: #a83a2a;    /* seal red */
    --mist: rgba(180, 160, 120, 0.18);

    --radius: 18px;
    --shadow: 0 18px 55px rgba(0,0,0,0.45);
    --blur: blur(16px);
    --ease: cubic-bezier(.2,.8,.2,1);
  }

  .sr-only{
    position:absolute!important;
    width:1px;height:1px;
    padding:0;margin:-1px;
    overflow:hidden;clip:rect(0,0,0,0);
    white-space:nowrap;border:0;
  }

  /* Header shell */
  .site-header{
    position: sticky;
    top: 0;
    z-index: 1000;
    border-bottom: 1px solid var(--line);
    background: linear-gradient(180deg, var(--bg-0), var(--bg-1));
    backdrop-filter: var(--blur);
    -webkit-backdrop-filter: var(--blur);
  }

  .header-wrap{
    max-width: 1280px;
    margin: 0 auto;
    padding: 14px 18px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 14px;
    transition: padding 220ms var(--ease);
  }

  #site-header[data-state="scrolled"] .header-wrap{
    padding: 9px 18px;
  }

  /* Brand */
  .brand{
    display:flex;
    align-items:center;
    gap: 10px;
    text-decoration:none;
    min-width: 220px;
  }

.brand-mark{
  width: 36px;
  height: 36px;
  border-radius: 14px;
  display: grid;
  place-items: center;
  background: radial-gradient(
    circle at 30% 30%,
    rgba(200,162,75,0.18),
    rgba(31,122,99,0.35)
  );
  border: 1px solid rgba(255,255,255,0.12);
  box-shadow:
    inset 0 0 0 1px rgba(255,255,255,0.06),
    0 12px 28px rgba(0,0,0,0.45);
}

.lotus-svg{
  width: 22px;
  height: 22px;
  fill: none;
  stroke: rgba(255,255,255,0.85);
  stroke-width: 2;
  filter: drop-shadow(0 2px 6px rgba(0,0,0,0.45));
}

.brand-mark:hover .lotus-svg{
  transform: scale(1.04);
  transition: transform 220ms ease;
}

@keyframes lotusGlow {
  0%,100% { opacity: 0.85; }
  50% { opacity: 1; }
}

.lotus-svg {
  animation: lotusGlow 6s ease-in-out infinite;
}

  .brand-text{ display:flex; flex-direction:column; line-height:1.05; }
  .brand-name{
    color: var(--ink-0);
    font-weight: 650;
    letter-spacing: 0.3px;
    font-size: 15px;
  }
  .brand-sub{
    color: var(--ink-2);
    font-size: 12px;
    margin-top: 4px;
  }

  /* Desktop nav */
  .nav{
    display:flex;
    align-items:center;
    gap: 6px;
    padding: 6px;
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,0.07);
    background: rgba(255,255,255,0.03);
    box-shadow: 0 12px 30px rgba(0,0,0,0.18);
  }

  .nav-link{
    position:relative;
    text-decoration:none;
    color: var(--ink-1);
    font-size: 13px;
    padding: 10px 12px;
    border-radius: 999px;
    transition: transform 180ms var(--ease), background 180ms var(--ease), color 180ms var(--ease);
    outline: none;
  }

  .nav-link:hover{
    background: rgba(200,162,75,0.10);
    color: var(--ink-0);
    transform: translateY(-0.5px);
  }

  .nav-link[aria-current="page"]{
    background: linear-gradient(180deg, rgba(31,122,99,0.20), rgba(31,122,99,0.10));
    border: 1px solid rgba(31,122,99,0.26);
    color: var(--ink-0);
  }

  .nav-link:focus-visible{
    box-shadow: 0 0 0 3px rgba(200,162,75,0.25);
  }

  /* Utilities */
  .utils{
    display:flex;
    align-items:center;
    gap: 10px;
  }

  .icon-btn{
    display:inline-flex;
    align-items:center;
    gap: 10px;
    padding: 10px 12px;
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,0.08);
    background: rgba(255,255,255,0.04);
    color: var(--ink-1);
    cursor:pointer;
    transition: background 180ms var(--ease), transform 180ms var(--ease), color 180ms var(--ease);
  }

  .icon-btn:hover{
    background: rgba(255,255,255,0.06);
    transform: translateY(-0.5px);
    color: var(--ink-0);
  }

  .icon-btn:focus-visible{
    outline:none;
    box-shadow: 0 0 0 3px rgba(200,162,75,0.25);
  }

  .icon{
    width: 18px;
    height: 18px;
  }

  .kbd-hint{
    font-size: 12px;
    color: var(--ink-2);
    border: 1px solid rgba(255,255,255,0.10);
    background: rgba(0,0,0,0.18);
    padding: 3px 8px;
    border-radius: 10px;
  }

  .cta{
    position: relative;
    text-decoration: none;
    color: rgba(10,12,14,0.92);
    font-weight: 650;
    font-size: 13px;
    padding: 11px 14px;
    border-radius: 999px;
    background: linear-gradient(135deg, rgba(200,162,75,1), rgba(235,210,140,0.96));
    box-shadow: 0 16px 40px rgba(0,0,0,0.38);
    overflow:hidden;
    transition: transform 180ms var(--ease), filter 180ms var(--ease);
  }

  .cta:hover{
    transform: translateY(-0.75px);
    filter: saturate(1.05);
  }

  .cta:focus-visible{
    outline:none;
    box-shadow: 0 0 0 3px rgba(200,162,75,0.28), 0 16px 40px rgba(0,0,0,0.38);
  }

  .cta-glint{
    position:absolute;
    inset: -40% -20%;
    background: radial-gradient(closest-side, rgba(255,255,255,0.55), transparent 60%);
    transform: translateX(-35%) rotate(18deg);
    opacity: 0.35;
    transition: transform 550ms var(--ease), opacity 550ms var(--ease);
    pointer-events:none;
  }

  .cta:hover .cta-glint{
    transform: translateX(35%) rotate(18deg);
    opacity: 0.42;
  }

  /* Burger (mobile only) */
  .burger{
    display:none;
    width: 42px;
    height: 42px;
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,0.08);
    background: rgba(255,255,255,0.04);
    color: var(--ink-1);
    cursor:pointer;
  }

  .burger-lines{
    width: 18px;
    height: 12px;
    display:block;
    margin: 0 auto;
    background:
      linear-gradient(currentColor, currentColor) 0 0 / 100% 2px,
      linear-gradient(currentColor, currentColor) 0 50% / 100% 2px,
      linear-gradient(currentColor, currentColor) 0 100% / 100% 2px;
    background-repeat:no-repeat;
    opacity: 0.95;
  }

  /* Mobile menu */
  .mobile-shell{
    position: fixed;
    inset: 0;
    z-index: 1200;
  }

  .mobile-scrim{
    position:absolute;
    inset:0;
    background: rgba(0,0,0,0.52);
    backdrop-filter: blur(2px);
  }

  .mobile-sheet{
    position:absolute;
    right: 14px;
    top: 14px;
    width: min(420px, calc(100% - 28px));
    border-radius: calc(var(--radius) + 6px);
    background: linear-gradient(180deg, rgba(14,16,18,0.92), rgba(14,16,18,0.78));
    border: 1px solid rgba(255,255,255,0.10);
    box-shadow: var(--shadow);
    overflow:hidden;
    transform: translateY(-6px);
    opacity: 0;
    transition: transform 220ms var(--ease), opacity 220ms var(--ease);
  }

  .mobile-shell[data-open="true"] .mobile-sheet{
    transform: translateY(0);
    opacity: 1;
  }

  .mobile-top{
    display:flex;
    align-items:center;
    justify-content: space-between;
    padding: 14px;
    border-bottom: 1px solid rgba(255,255,255,0.08);
    background: rgba(255,255,255,0.03);
  }

  .brand--mobile{ min-width: auto; }

  .mobile-nav{
    padding: 10px;
    display:grid;
    gap: 6px;
  }

  .mobile-link{
    text-decoration:none;
    color: var(--ink-1);
    padding: 12px 12px;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,0.08);
    background: rgba(255,255,255,0.03);
    transition: background 180ms var(--ease), transform 180ms var(--ease), color 180ms var(--ease);
  }

  .mobile-link:hover{
    background: rgba(200,162,75,0.10);
    color: var(--ink-0);
    transform: translateY(-0.5px);
  }

  .mobile-footer{
    padding: 12px 14px 14px;
    border-top: 1px solid rgba(255,255,255,0.08);
    background: rgba(255,255,255,0.02);
  }

  .cta--full{
    display:flex;
    justify-content:center;
    width: 100%;
  }

  .mobile-note{
    margin: 10px 0 0;
    color: var(--ink-2);
    font-size: 12px;
    text-align:center;
  }

  /* Command palette */
  .cmdk{
    position: fixed;
    inset: 0;
    z-index: 1300;
  }

  .cmdk-scrim{
    position:absolute;
    inset:0;
    background: rgba(0,0,0,0.58);
    backdrop-filter: blur(2px);
  }

  .cmdk-panel{
    position: absolute;
    left: 50%;
    top: 16%;
    transform: translateX(-50%);
    width: min(720px, calc(100% - 28px));
    border-radius: calc(var(--radius) + 10px);
    background: linear-gradient(180deg, rgba(14,16,18,0.92), rgba(14,16,18,0.78));
    border: 1px solid rgba(255,255,255,0.12);
    box-shadow: var(--shadow);
    overflow:hidden;
  }

  .cmdk-head{
    display:flex;
    align-items:center;
    justify-content: space-between;
    padding: 14px 16px;
    border-bottom: 1px solid rgba(255,255,255,0.08);
    background: rgba(255,255,255,0.03);
  }

  .cmdk-title{
    color: var(--ink-0);
    font-weight: 650;
    letter-spacing: 0.2px;
  }

  .cmdk-hints{
    color: var(--ink-2);
    font-size: 12px;
    display:flex;
    gap: 10px;
    align-items:center;
  }

  .pill{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    padding: 3px 8px;
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,0.10);
    background: rgba(0,0,0,0.20);
    color: var(--ink-1);
    margin-right: 6px;
  }

  .cmdk-input{
    width: 100%;
    padding: 14px 16px;
    border: 0;
    outline: none;
    background: rgba(0,0,0,0.16);
    color: var(--ink-0);
    font-size: 14px;
  }

  .cmdk-input::placeholder{ color: rgba(255,255,255,0.38); }

  .cmdk-list{
    padding: 10px;
    display:grid;
    gap: 8px;
    max-height: min(52vh, 420px);
    overflow:auto;
  }

  .cmdk-item{
    width: 100%;
    text-align:left;
    display:flex;
    justify-content: space-between;
    gap: 14px;
    padding: 12px 12px;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,0.08);
    background: rgba(255,255,255,0.03);
    color: var(--ink-1);
    cursor:pointer;
    transition: background 180ms var(--ease), transform 180ms var(--ease), color 180ms var(--ease);
  }

  .cmdk-item:hover{
    background: rgba(31,122,99,0.14);
    color: var(--ink-0);
    transform: translateY(-0.5px);
  }

  .cmdk-item:focus-visible{
    outline:none;
    box-shadow: 0 0 0 3px rgba(31,122,99,0.25);
  }

  .cmdk-item .meta{
    color: rgba(255,255,255,0.48);
    font-size: 12px;
  }

  /* Responsive rules */
  @media (max-width: 1020px){
    .nav{ display:none; }
    .burger{ display:inline-flex; align-items:center; justify-content:center; }
    .brand{ min-width: auto; }
  }

  @media (prefers-reduced-motion: reduce){
    * { transition: none !important; scroll-behavior: auto !important; }
  }
</style>

<script>
  (function () {
    const header = document.getElementById("site-header");
    const menuBtn = document.getElementById("menu-btn");
    const mobileShell = document.getElementById("mobile-menu");

    const cmdkBtn = document.getElementById("cmdk-btn");
    const cmdk = document.getElementById("cmdk");
    const cmdkInput = document.getElementById("cmdk-input");
    const cmdkList = document.getElementById("cmdk-list");

    // Shrink-on-scroll
    const setHeaderState = () => {
      const scrolled = window.scrollY > 8;
      header.setAttribute("data-state", scrolled ? "scrolled" : "top");
    };
    setHeaderState();
    window.addEventListener("scroll", setHeaderState, { passive: true });

    // Active link (based on pathname)
    const path = (location.pathname.split("/").pop() || "index.html").toLowerCase();
    document.querySelectorAll(".nav-link").forEach(a => {
      const href = (a.getAttribute("href") || "").toLowerCase();
      if (href === path) a.setAttribute("aria-current", "page");
    });

    // Mobile menu open/close
    const openMenu = () => {
      mobileShell.hidden = false;
      mobileShell.dataset.open = "true";
      menuBtn.setAttribute("aria-expanded", "true");
      document.body.style.overflow = "hidden";
      // Focus first mobile link for keyboard users
      const firstLink = mobileShell.querySelector(".mobile-link");
      if (firstLink) firstLink.focus({ preventScroll: true });
    };

    const closeMenu = () => {
      mobileShell.dataset.open = "false";
      menuBtn.setAttribute("aria-expanded", "false");
      document.body.style.overflow = "";
      // Allow exit animation before hiding
      setTimeout(() => { mobileShell.hidden = true; }, 180);
      menuBtn.focus({ preventScroll: true });
    };

    if (menuBtn && mobileShell) {
      menuBtn.addEventListener("click", () => {
        const expanded = menuBtn.getAttribute("aria-expanded") === "true";
        expanded ? closeMenu() : openMenu();
      });

      mobileShell.addEventListener("click", (e) => {
        const closeTarget = e.target.closest("[data-close]");
        if (closeTarget) closeMenu();
      });

      window.addEventListener("keydown", (e) => {
        if (e.key === "Escape" && !mobileShell.hidden) closeMenu();
      });
    }

    // Command palette open/close
    const openCmdk = () => {
      cmdk.hidden = false;
      document.body.style.overflow = "hidden";
      cmdkInput.value = "";
      filterCmdk("");
      setTimeout(() => cmdkInput.focus({ preventScroll: true }), 0);
    };

    const closeCmdk = () => {
      cmdk.hidden = true;
      document.body.style.overflow = "";
      cmdkBtn.focus({ preventScroll: true });
    };

    const filterCmdk = (q) => {
      const query = (q || "").trim().toLowerCase();
      const items = Array.from(cmdkList.querySelectorAll(".cmdk-item"));
      let anyVisible = false;
      items.forEach((btn) => {
        const text = btn.textContent.toLowerCase();
        const show = text.includes(query);
        btn.hidden = !show;
        if (show) anyVisible = true;
      });
      // Keep UX calm even when no matches
      cmdkList.dataset.empty = anyVisible ? "false" : "true";
    };

    if (cmdkBtn && cmdk) {
      cmdkBtn.addEventListener("click", openCmdk);

      cmdk.addEventListener("click", (e) => {
        if (e.target.closest("[data-cmdk-close]")) closeCmdk();
      });

      window.addEventListener("keydown", (e) => {
        const key = e.key;
        const isTyping = document.activeElement === cmdkInput;

        if (key === "/" && !e.metaKey && !e.ctrlKey && !e.altKey) {
          // Allow "/" to focus palette when not typing in an input/textarea
          const tag = (document.activeElement && document.activeElement.tagName || "").toLowerCase();
          const isForm = tag === "input" || tag === "textarea" || tag === "select";
          if (!isForm && cmdk.hidden) {
            e.preventDefault();
            openCmdk();
          }
        }

        if (key === "Escape" && !cmdk.hidden) {
          e.preventDefault();
          closeCmdk();
        }

        if (key === "Enter" && !cmdk.hidden && isTyping) {
          const first = cmdkList.querySelector(".cmdk-item:not([hidden])");
          if (first) first.click();
        }
      });

      cmdkInput.addEventListener("input", (e) => filterCmdk(e.target.value));

      cmdkList.addEventListener("click", (e) => {
        const item = e.target.closest(".cmdk-item");
        if (!item) return;
        const href = item.getAttribute("data-href");
        if (href) location.href = href;
      });
    }
  })();
</script>
